"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Menu = exports.Position = void 0;
const React = __importStar(require("react"));
const react_native_1 = require("react-native");
var Position;
(function (Position) {
    Position[Position["TOP_LEFT"] = 0] = "TOP_LEFT";
    Position[Position["TOP_RIGHT"] = 1] = "TOP_RIGHT";
    Position[Position["TOP_CENTER"] = 2] = "TOP_CENTER";
    Position[Position["BOTTOM_LEFT"] = 3] = "BOTTOM_LEFT";
    Position[Position["BOTTOM_RIGHT"] = 4] = "BOTTOM_RIGHT";
    Position[Position["BOTTOM_CENTER"] = 5] = "BOTTOM_CENTER";
})(Position = exports.Position || (exports.Position = {}));
const ANIMATION_DURATION = 300;
const EASING = react_native_1.Easing.bezier(0.4, 0, 0.2, 1);
const SCREEN_INDENT = 8;
const normalizeOffset = (extraOffset) => {
    const reducer = ({ left, top }, [prop, value]) => {
        if (prop === 'left') {
            left += value;
        }
        else if (prop === 'right') {
            left -= value;
        }
        else if (prop === 'top') {
            top += value;
        }
        else if (prop === 'bottom') {
            top -= value;
        }
        return { left, top };
    };
    return Object.entries(extraOffset).reduce(reducer, { left: 0, top: 0 });
};
const getSummarizedOffset = (offsetList) => {
    const reducer = (acc, { left, top }) => ({
        left: acc.left + left,
        top: acc.top + top
    });
    return offsetList.reduce(reducer, { left: 0, top: 0 });
};
const getMenuOffset = (stickTo, component, menu) => {
    if (stickTo === Position.TOP_RIGHT) {
        const left = component.left + (component.width - menu.width);
        const top = component.top;
        return { left, top };
    }
    else if (stickTo === Position.BOTTOM_LEFT) {
        const left = component.left;
        const top = component.top + component.height;
        return { left, top };
    }
    else if (stickTo === Position.BOTTOM_RIGHT) {
        const left = component.left + (component.width - menu.width);
        const top = component.top + component.height;
        return { left, top };
    }
    else if (stickTo === Position.TOP_LEFT) {
        const left = component.left;
        const top = component.top;
        return { left, top };
    }
    else if (stickTo === Position.TOP_CENTER) {
        const left = component.left + Math.round((component.width - menu.width) / 2);
        const top = component.top;
        return { left, top };
    }
    else if (stickTo === Position.BOTTOM_CENTER) {
        const left = component.left + Math.round((component.width - menu.width) / 2);
        const top = component.top + component.height;
        return { left, top };
    }
    return { left: 0, top: 0 };
};
const getComputedOffset = (func, left, top, width, height) => {
    if (func) {
        const extraOffset = func(left, top, width, height);
        return normalizeOffset(extraOffset);
    }
    return null;
};
class Menu extends React.Component {
    constructor(props) {
        super(props);
        this.show = (componentRef, stickTo = null, extraOffset = null, computeOffset = null) => {
            if (componentRef !== null) {
                componentRef.measureInWindow((x, y, width, height) => {
                    const top = Math.max(SCREEN_INDENT, y);
                    const left = Math.max(SCREEN_INDENT, x);
                    const computedOffset = getComputedOffset(computeOffset, left, top, width, height);
                    const oldOffsets = Object.assign({}, this.state.offsets);
                    const newState = Object.assign({ menuState: 0 /* MEASURING */, component: { left, top, width, height }, offsets: Object.assign(Object.assign(Object.assign({}, oldOffsets), (extraOffset
                            ? { staticOffset: normalizeOffset(extraOffset) }
                            : {})), (computedOffset ? { computedOffset } : {})) }, (stickTo ? { stickTo } : {}));
                    this.setState(newState);
                });
            }
        };
        /* Measure new menu width and height */
        this._onMenuLayout = (event) => {
            const { width, height } = event.nativeEvent.layout;
            const { menuState, menu } = this.state;
            if (menuState === 0 /* MEASURING */) {
                this.setState({
                    menuState: 1 /* CALCULATING */,
                    menu: Object.assign(Object.assign({}, menu), { width,
                        height })
                });
            }
        };
        this._onDismiss = () => {
            if (this.props.onHidden) {
                this.props.onHidden();
            }
        };
        this.hide = () => {
            const { animation } = this.state;
            react_native_1.Animated.timing(this.state.animation.opacity, {
                toValue: 0,
                duration: ANIMATION_DURATION,
                easing: EASING,
                useNativeDriver: false
            }).start(() => {
                /* Reset state */
                this.setState({
                    menuState: 3 /* HIDDEN */,
                    animation: Object.assign(Object.assign({}, animation), { menuSize: new react_native_1.Animated.ValueXY({ x: 0, y: 0 }), opacity: new react_native_1.Animated.Value(0) })
                }, () => {
                    /* Invoke onHidden callback if defined */
                    if (react_native_1.Platform.OS !== 'ios' && this.props.onHidden) {
                        this.props.onHidden();
                    }
                });
            });
        };
        this.state = {
            menuState: 3 /* HIDDEN */,
            stickTo: Position.TOP_LEFT,
            component: {
                left: 0,
                top: 0,
                width: 0,
                height: 0
            },
            menu: {
                left: 0,
                top: 0,
                width: 0,
                height: 0
            },
            offsets: {
                staticOffset: {
                    left: 0,
                    top: 0
                },
                computedOffset: {
                    left: 0,
                    top: 0
                }
            },
            animation: {
                menuSize: new react_native_1.Animated.ValueXY({ x: 0, y: 0 }),
                opacity: new react_native_1.Animated.Value(0)
            }
        };
    }
    componentDidUpdate() {
        const { menuState, menu } = this.state;
        if (menuState === 4 /* ANIMATING */) {
            return;
        }
        if (menuState === 1 /* CALCULATING */) {
            const { stickTo, component, offsets } = this.state;
            const baseOffset = getMenuOffset(stickTo, component, menu);
            const allOffsets = [
                baseOffset,
                offsets.staticOffset,
                offsets.computedOffset
            ];
            const finalOffset = getSummarizedOffset(allOffsets);
            this.setState({
                menuState: 2 /* SHOWN */,
                menu: Object.assign(Object.assign({}, menu), { left: finalOffset.left, top: finalOffset.top })
            });
        }
        else if (menuState === 2 /* SHOWN */) {
            const { animation } = this.state;
            this.setState({
                menuState: 4 /* ANIMATING */
            }, () => {
                react_native_1.Animated.parallel([
                    react_native_1.Animated.timing(animation.menuSize, {
                        toValue: { x: menu.width, y: menu.height },
                        duration: ANIMATION_DURATION,
                        easing: EASING,
                        useNativeDriver: false
                    }),
                    react_native_1.Animated.timing(animation.opacity, {
                        toValue: 1,
                        duration: ANIMATION_DURATION,
                        easing: EASING,
                        useNativeDriver: false
                    })
                ]).start();
            });
        }
    }
    render() {
        const dimensions = react_native_1.Dimensions.get('screen');
        const { menu, component, animation } = this.state;
        const menuSize = {
            width: animation.menuSize.x,
            height: animation.menuSize.y
        };
        /* Adjust position of menu */
        const transforms = [];
        /* Flip by X axis if menu hits right screen border */
        if (menu.left > dimensions.width - menu.width - SCREEN_INDENT) {
            transforms.push({
                translateX: react_native_1.Animated.multiply(animation.menuSize.x, -1)
            });
            menu.left = Math.min(dimensions.width - SCREEN_INDENT, menu.left + component.width);
        }
        /* Flip by Y axis if menu hits bottom screen border */
        if (menu.top > dimensions.height - menu.height - SCREEN_INDENT) {
            transforms.push({
                translateY: react_native_1.Animated.multiply(animation.menuSize.y, -1)
            });
            menu.top = Math.min(dimensions.height - SCREEN_INDENT, menu.top + component.height);
        }
        const shadowMenuContainerStyle = {
            opacity: animation.opacity,
            transform: transforms,
            left: menu.left,
            top: menu.top
        };
        const { menuState } = this.state;
        const animationStarted = menuState === 4 /* ANIMATING */;
        const modalVisible = menuState === 0 /* MEASURING */ ||
            menuState === 1 /* CALCULATING */ ||
            menuState === 2 /* SHOWN */ ||
            animationStarted;
        const { testID, style, children } = this.props;
        return (<react_native_1.View collapsable={false} testID={testID}>
        <react_native_1.Modal visible={modalVisible} onRequestClose={this.hide} supportedOrientations={[
            'portrait',
            'portrait-upside-down',
            'landscape',
            'landscape-left',
            'landscape-right'
        ]} transparent onDismiss={this._onDismiss}>
          <react_native_1.TouchableWithoutFeedback onPress={this.hide}>
            <react_native_1.View style={react_native_1.StyleSheet.absoluteFill}>
              <react_native_1.Animated.View {...(!animationStarted ? { onLayout: this._onMenuLayout } : {})} style={[
            styles.shadowMenuContainer,
            shadowMenuContainerStyle,
            style
        ]}>
                <react_native_1.Animated.View style={[styles.menuContainer, animationStarted && menuSize]}>
                  {children}
                </react_native_1.Animated.View>
              </react_native_1.Animated.View>
            </react_native_1.View>
          </react_native_1.TouchableWithoutFeedback>
        </react_native_1.Modal>
      </react_native_1.View>);
    }
}
exports.Menu = Menu;
const styles = react_native_1.StyleSheet.create({
    shadowMenuContainer: Object.assign({ position: 'absolute', backgroundColor: 'white', borderRadius: 4, opacity: 0 }, react_native_1.Platform.select({
        ios: {
            shadowColor: 'black',
            shadowOffset: { width: 0, height: 2 },
            shadowOpacity: 0.14,
            shadowRadius: 2
        },
        android: {
            elevation: 8
        }
    })),
    menuContainer: {
        overflow: 'hidden'
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVudS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9NZW51LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkNBQStCO0FBRS9CLCtDQWFzQjtBQUV0QixJQUFZLFFBT1g7QUFQRCxXQUFZLFFBQVE7SUFDbEIsK0NBQVEsQ0FBQTtJQUNSLGlEQUFTLENBQUE7SUFDVCxtREFBVSxDQUFBO0lBQ1YscURBQVcsQ0FBQTtJQUNYLHVEQUFZLENBQUE7SUFDWix5REFBYSxDQUFBO0FBQ2YsQ0FBQyxFQVBXLFFBQVEsR0FBUixnQkFBUSxLQUFSLGdCQUFRLFFBT25CO0FBYUQsTUFBTSxrQkFBa0IsR0FBRyxHQUFHLENBQUM7QUFDL0IsTUFBTSxNQUFNLEdBQUcscUJBQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDN0MsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFDO0FBc0J4QixNQUFNLGVBQWUsR0FBRyxDQUFDLFdBQW1CLEVBQWlCLEVBQUU7SUFDN0QsTUFBTSxPQUFPLEdBQUcsQ0FDZCxFQUFFLElBQUksRUFBRSxHQUFHLEVBQWlDLEVBQzVDLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBbUIsRUFDL0IsRUFBRTtRQUNGLElBQUksSUFBSSxLQUFLLE1BQU0sRUFBRTtZQUNuQixJQUFJLElBQUksS0FBSyxDQUFDO1NBQ2Y7YUFBTSxJQUFJLElBQUksS0FBSyxPQUFPLEVBQUU7WUFDM0IsSUFBSSxJQUFJLEtBQUssQ0FBQztTQUNmO2FBQU0sSUFBSSxJQUFJLEtBQUssS0FBSyxFQUFFO1lBQ3pCLEdBQUcsSUFBSSxLQUFLLENBQUM7U0FDZDthQUFNLElBQUksSUFBSSxLQUFLLFFBQVEsRUFBRTtZQUM1QixHQUFHLElBQUksS0FBSyxDQUFDO1NBQ2Q7UUFDRCxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDO0lBQ3ZC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YWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHtcbiAgQW5pbWF0ZWQsXG4gIERpbWVuc2lvbnMsXG4gIEVhc2luZyxcbiAgTW9kYWwsXG4gIFBsYXRmb3JtLFxuICBTdHlsZVNoZWV0LFxuICBUb3VjaGFibGVXaXRob3V0RmVlZGJhY2ssXG4gIFZpZXcsXG4gIE5hdGl2ZU1ldGhvZHMsXG4gIFN0eWxlUHJvcCxcbiAgVmlld1N0eWxlLFxuICBMYXlvdXRDaGFuZ2VFdmVudFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG5leHBvcnQgZW51bSBQb3NpdGlvbiB7XG4gIFRPUF9MRUZULFxuICBUT1BfUklHSFQsXG4gIFRPUF9DRU5URVIsXG4gIEJPVFRPTV9MRUZULFxuICBCT1RUT01fUklHSFQsXG4gIEJPVFRPTV9DRU5URVJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPZmZzZXQge1xuICB0b3A/OiBudW1iZXI7XG4gIGxlZnQ/OiBudW1iZXI7XG4gIHJpZ2h0PzogbnVtYmVyO1xuICBib3R0b20/OiBudW1iZXI7XG59XG5cbmV4cG9ydCB0eXBlIENvbXB1dGVPZmZzZXRDYWxsYmFjayA9XG4gIHwgKChsZWZ0OiBudW1iZXIsIHRvcDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4gT2Zmc2V0KVxuICB8IG51bGw7XG5cbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDMwMDtcbmNvbnN0IEVBU0lORyA9IEVhc2luZy5iZXppZXIoMC40LCAwLCAwLjIsIDEpO1xuY29uc3QgU0NSRUVOX0lOREVOVCA9IDg7XG5cbmNvbnN0IGVudW0gU1RBVEVTIHtcbiAgTUVBU1VSSU5HLFxuICBDQUxDVUxBVElORyxcbiAgU0hPV04sXG4gIEhJRERFTixcbiAgQU5JTUFUSU5HXG59XG5cbnR5cGUgUG9zaXRpb25TaGlmdCA9IHtcbiAgbGVmdDogbnVtYmVyO1xuICB0b3A6IG51bWJlcjtcbn07XG5cbmludGVyZmFjZSBDb21wb25lbnRMYXlvdXQge1xuICBsZWZ0OiBudW1iZXI7XG4gIHRvcDogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbn1cblxuY29uc3Qgbm9ybWFsaXplT2Zmc2V0ID0gKGV4dHJhT2Zmc2V0OiBPZmZzZXQpOiBQb3NpdGlvblNoaWZ0ID0+IHtcbiAgY29uc3QgcmVkdWNlciA9IChcbiAgICB7IGxlZnQsIHRvcCB9OiB7IGxlZnQ6IG51bWJlcjsgdG9wOiBudW1iZXIgfSxcbiAgICBbcHJvcCwgdmFsdWVdOiBbc3RyaW5nLCBudW1iZXJdXG4gICkgPT4ge1xuICAgIGlmIChwcm9wID09PSAnbGVmdCcpIHtcbiAgICAgIGxlZnQgKz0gdmFsdWU7XG4gICAgfSBlbHNlIGlmIChwcm9wID09PSAncmlnaHQnKSB7XG4gICAgICBsZWZ0IC09IHZhbHVlO1xuICAgIH0gZWxzZSBpZiAocHJvcCA9PT0gJ3RvcCcpIHtcbiAgICAgIHRvcCArPSB2YWx1ZTtcbiAgICB9IGVsc2UgaWYgKHByb3AgPT09ICdib3R0b20nKSB7XG4gICAgICB0b3AgLT0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB7IGxlZnQsIHRvcCB9O1xuICB9O1xuXG4gIHJldHVybiBPYmplY3QuZW50cmllcyhleHRyYU9mZnNldCkucmVkdWNlKHJlZHVjZXIsIHsgbGVmdDogMCwgdG9wOiAwIH0pO1xufTtcblxuY29uc3QgZ2V0U3VtbWFyaXplZE9mZnNldCA9IChvZmZzZXRMaXN0OiBQb3NpdGlvblNoaWZ0W10pID0+IHtcbiAgY29uc3QgcmVkdWNlciA9IChhY2M6IFBvc2l0aW9uU2hpZnQsIHsgbGVmdCwgdG9wIH06IFBvc2l0aW9uU2hpZnQpID0+ICh7XG4gICAgbGVmdDogYWNjLmxlZnQgKyBsZWZ0LFxuICAgIHRvcDogYWNjLnRvcCArIHRvcFxuICB9KTtcbiAgcmV0dXJuIG9mZnNldExpc3QucmVkdWNlKHJlZHVjZXIsIHsgbGVmdDogMCwgdG9wOiAwIH0pO1xufTtcblxuY29uc3QgZ2V0TWVudU9mZnNldCA9IChcbiAgc3RpY2tUbzogUG9zaXRpb24sXG4gIGNvbXBvbmVudDogQ29tcG9uZW50TGF5b3V0LFxuICBtZW51OiBDb21wb25lbnRMYXlvdXRcbik6IFBvc2l0aW9uU2hpZnQgPT4ge1xuICBpZiAoc3RpY2tUbyA9PT0gUG9zaXRpb24uVE9QX1JJR0hUKSB7XG4gICAgY29uc3QgbGVmdCA9IGNvbXBvbmVudC5sZWZ0ICsgKGNvbXBvbmVudC53aWR0aCAtIG1lbnUud2lkdGgpO1xuICAgIGNvbnN0IHRvcCA9IGNvbXBvbmVudC50b3A7XG4gICAgcmV0dXJuIHsgbGVmdCwgdG9wIH07XG4gIH0gZWxzZSBpZiAoc3RpY2tUbyA9PT0gUG9zaXRpb24uQk9UVE9NX0xFRlQpIHtcbiAgICBjb25zdCBsZWZ0ID0gY29tcG9uZW50LmxlZnQ7XG4gICAgY29uc3QgdG9wID0gY29tcG9uZW50LnRvcCArIGNvbXBvbmVudC5oZWlnaHQ7XG4gICAgcmV0dXJuIHsgbGVmdCwgdG9wIH07XG4gIH0gZWxzZSBpZiAoc3RpY2tUbyA9PT0gUG9zaXRpb24uQk9UVE9NX1JJR0hUKSB7XG4gICAgY29uc3QgbGVmdCA9IGNvbXBvbmVudC5sZWZ0ICsgKGNvbXBvbmVudC53aWR0aCAtIG1lbnUud2lkdGgpO1xuICAgIGNvbnN0IHRvcCA9IGNvbXBvbmVudC50b3AgKyBjb21wb25lbnQuaGVpZ2h0O1xuICAgIHJldHVybiB7IGxlZnQsIHRvcCB9O1xuICB9IGVsc2UgaWYgKHN0aWNrVG8gPT09IFBvc2l0aW9uLlRPUF9MRUZUKSB7XG4gICAgY29uc3QgbGVmdCA9IGNvbXBvbmVudC5sZWZ0O1xuICAgIGNvbnN0IHRvcCA9IGNvbXBvbmVudC50b3A7XG4gICAgcmV0dXJuIHsgbGVmdCwgdG9wIH07XG4gIH0gZWxzZSBpZiAoc3RpY2tUbyA9PT0gUG9zaXRpb24uVE9QX0NFTlRFUikge1xuICAgIGNvbnN0IGxlZnQgPVxuICAgICAgY29tcG9uZW50LmxlZnQgKyBNYXRoLnJvdW5kKChjb21wb25lbnQud2lkdGggLSBtZW51LndpZHRoKSAvIDIpO1xuICAgIGNvbnN0IHRvcCA9IGNvbXBvbmVudC50b3A7XG4gICAgcmV0dXJuIHsgbGVmdCwgdG9wIH07XG4gIH0gZWxzZSBpZiAoc3RpY2tUbyA9PT0gUG9zaXRpb24uQk9UVE9NX0NFTlRFUikge1xuICAgIGNvbnN0IGxlZnQgPVxuICAgICAgY29tcG9uZW50LmxlZnQgKyBNYXRoLnJvdW5kKChjb21wb25lbnQud2lkdGggLSBtZW51LndpZHRoKSAvIDIpO1xuICAgIGNvbnN0IHRvcCA9IGNvbXBvbmVudC50b3AgKyBjb21wb25lbnQuaGVpZ2h0O1xuICAgIHJldHVybiB7IGxlZnQsIHRvcCB9O1xuICB9XG5cbiAgcmV0dXJuIHsgbGVmdDogMCwgdG9wOiAwIH07XG59O1xuXG5jb25zdCBnZXRDb21wdXRlZE9mZnNldCA9IChcbiAgZnVuYzogQ29tcHV0ZU9mZnNldENhbGxiYWNrLFxuICBsZWZ0OiBudW1iZXIsXG4gIHRvcDogbnVtYmVyLFxuICB3aWR0aDogbnVtYmVyLFxuICBoZWlnaHQ6IG51bWJlclxuKSA9PiB7XG4gIGlmIChmdW5jKSB7XG4gICAgY29uc3QgZXh0cmFPZmZzZXQgPSBmdW5jKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZU9mZnNldChleHRyYU9mZnNldCk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5pbnRlcmZhY2UgUHJvcHMge1xuICB0ZXN0SUQ/OiBzdHJpbmc7XG4gIHN0eWxlPzogU3R5bGVQcm9wPFZpZXdTdHlsZT47XG4gIG9uSGlkZGVuPzogKCkgPT4ge307XG59XG5cbmludGVyZmFjZSBTdGF0ZSB7XG4gIG1lbnVTdGF0ZTogU1RBVEVTO1xuICBzdGlja1RvOiBQb3NpdGlvbjtcbiAgY29tcG9uZW50OiBDb21wb25lbnRMYXlvdXQ7XG4gIG1lbnU6IENvbXBvbmVudExheW91dDtcbiAgb2Zmc2V0czoge1xuICAgIHN0YXRpY09mZnNldDogUG9zaXRpb25TaGlmdDtcbiAgICBjb21wdXRlZE9mZnNldDogUG9zaXRpb25TaGlmdDtcbiAgfTtcbiAgYW5pbWF0aW9uOiB7XG4gICAgbWVudVNpemU6IEFuaW1hdGVkLlZhbHVlWFk7XG4gICAgb3BhY2l0eTogQW5pbWF0ZWQuVmFsdWU7XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBNZW51IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzLCBTdGF0ZT4ge1xuICBjb25zdHJ1Y3Rvcihwcm9wczogUHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgbWVudVN0YXRlOiBTVEFURVMuSElEREVOLFxuICAgICAgc3RpY2tUbzogUG9zaXRpb24uVE9QX0xFRlQsXG4gICAgICBjb21wb25lbnQ6IHtcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgaGVpZ2h0OiAwXG4gICAgICB9LFxuICAgICAgbWVudToge1xuICAgICAgICBsZWZ0OiAwLFxuICAgICAgICB0b3A6IDAsXG4gICAgICAgIHdpZHRoOiAwLFxuICAgICAgICBoZWlnaHQ6IDBcbiAgICAgIH0sXG4gICAgICBvZmZzZXRzOiB7XG4gICAgICAgIHN0YXRpY09mZnNldDoge1xuICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgdG9wOiAwXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXB1dGVkT2Zmc2V0OiB7XG4gICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICB0b3A6IDBcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFuaW1hdGlvbjoge1xuICAgICAgICBtZW51U2l6ZTogbmV3IEFuaW1hdGVkLlZhbHVlWFkoeyB4OiAwLCB5OiAwIH0pLFxuICAgICAgICBvcGFjaXR5OiBuZXcgQW5pbWF0ZWQuVmFsdWUoMClcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIGNvbnN0IHsgbWVudVN0YXRlLCBtZW51IH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgaWYgKG1lbnVTdGF0ZSA9PT0gU1RBVEVTLkFOSU1BVElORykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAobWVudVN0YXRlID09PSBTVEFURVMuQ0FMQ1VMQVRJTkcpIHtcbiAgICAgIGNvbnN0IHsgc3RpY2tUbywgY29tcG9uZW50LCBvZmZzZXRzIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgICBjb25zdCBiYXNlT2Zmc2V0ID0gZ2V0TWVudU9mZnNldChzdGlja1RvLCBjb21wb25lbnQsIG1lbnUpO1xuICAgICAgY29uc3QgYWxsT2Zmc2V0cyA9IFtcbiAgICAgICAgYmFzZU9mZnNldCxcbiAgICAgICAgb2Zmc2V0cy5zdGF0aWNPZmZzZXQsXG4gICAgICAgIG9mZnNldHMuY29tcHV0ZWRPZmZzZXRcbiAgICAgIF07XG4gICAgICBjb25zdCBmaW5hbE9mZnNldCA9IGdldFN1bW1hcml6ZWRPZmZzZXQoYWxsT2Zmc2V0cyk7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgbWVudVN0YXRlOiBTVEFURVMuU0hPV04sXG4gICAgICAgIG1lbnU6IHtcbiAgICAgICAgICAuLi5tZW51LFxuICAgICAgICAgIGxlZnQ6IGZpbmFsT2Zmc2V0LmxlZnQsXG4gICAgICAgICAgdG9wOiBmaW5hbE9mZnNldC50b3BcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChtZW51U3RhdGUgPT09IFNUQVRFUy5TSE9XTikge1xuICAgICAgY29uc3QgeyBhbmltYXRpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICB0aGlzLnNldFN0YXRlKFxuICAgICAgICB7XG4gICAgICAgICAgbWVudVN0YXRlOiBTVEFURVMuQU5JTUFUSU5HXG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBBbmltYXRlZC5wYXJhbGxlbChbXG4gICAgICAgICAgICBBbmltYXRlZC50aW1pbmcoYW5pbWF0aW9uLm1lbnVTaXplLCB7XG4gICAgICAgICAgICAgIHRvVmFsdWU6IHsgeDogbWVudS53aWR0aCwgeTogbWVudS5oZWlnaHQgfSxcbiAgICAgICAgICAgICAgZHVyYXRpb246IEFOSU1BVElPTl9EVVJBVElPTixcbiAgICAgICAgICAgICAgZWFzaW5nOiBFQVNJTkcsXG4gICAgICAgICAgICAgIHVzZU5hdGl2ZURyaXZlcjogZmFsc2VcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgQW5pbWF0ZWQudGltaW5nKGFuaW1hdGlvbi5vcGFjaXR5LCB7XG4gICAgICAgICAgICAgIHRvVmFsdWU6IDEsXG4gICAgICAgICAgICAgIGR1cmF0aW9uOiBBTklNQVRJT05fRFVSQVRJT04sXG4gICAgICAgICAgICAgIGVhc2luZzogRUFTSU5HLFxuICAgICAgICAgICAgICB1c2VOYXRpdmVEcml2ZXI6IGZhbHNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF0pLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgc2hvdyA9IChcbiAgICBjb21wb25lbnRSZWY6IFJlYWN0LlJlZk9iamVjdDxcbiAgICAgIFJlYWN0LkNvbXBvbmVudDxhbnk+ICYgUmVhZG9ubHk8TmF0aXZlTWV0aG9kcz5cbiAgICA+WydjdXJyZW50J10sXG4gICAgc3RpY2tUbzogUG9zaXRpb24gfCBudWxsID0gbnVsbCxcbiAgICBleHRyYU9mZnNldDogT2Zmc2V0IHwgbnVsbCA9IG51bGwsXG4gICAgY29tcHV0ZU9mZnNldDogQ29tcHV0ZU9mZnNldENhbGxiYWNrID0gbnVsbFxuICApID0+IHtcbiAgICBpZiAoY29tcG9uZW50UmVmICE9PSBudWxsKSB7XG4gICAgICBjb21wb25lbnRSZWYubWVhc3VyZUluV2luZG93KFxuICAgICAgICAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgY29uc3QgdG9wID0gTWF0aC5tYXgoU0NSRUVOX0lOREVOVCwgeSk7XG4gICAgICAgICAgY29uc3QgbGVmdCA9IE1hdGgubWF4KFNDUkVFTl9JTkRFTlQsIHgpO1xuXG4gICAgICAgICAgY29uc3QgY29tcHV0ZWRPZmZzZXQgPSBnZXRDb21wdXRlZE9mZnNldChcbiAgICAgICAgICAgIGNvbXB1dGVPZmZzZXQsXG4gICAgICAgICAgICBsZWZ0LFxuICAgICAgICAgICAgdG9wLFxuICAgICAgICAgICAgd2lkdGgsXG4gICAgICAgICAgICBoZWlnaHRcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IG9sZE9mZnNldHMgPSB7IC4uLnRoaXMuc3RhdGUub2Zmc2V0cyB9O1xuICAgICAgICAgIGNvbnN0IG5ld1N0YXRlOiBQaWNrPFN0YXRlLCAnbWVudVN0YXRlJyB8ICdjb21wb25lbnQnIHwgJ29mZnNldHMnPiA9IHtcbiAgICAgICAgICAgIG1lbnVTdGF0ZTogU1RBVEVTLk1FQVNVUklORyxcbiAgICAgICAgICAgIGNvbXBvbmVudDogeyBsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQgfSxcbiAgICAgICAgICAgIG9mZnNldHM6IHtcbiAgICAgICAgICAgICAgLi4ub2xkT2Zmc2V0cyxcbiAgICAgICAgICAgICAgLi4uKGV4dHJhT2Zmc2V0XG4gICAgICAgICAgICAgICAgPyB7IHN0YXRpY09mZnNldDogbm9ybWFsaXplT2Zmc2V0KGV4dHJhT2Zmc2V0KSB9XG4gICAgICAgICAgICAgICAgOiB7fSksXG4gICAgICAgICAgICAgIC4uLihjb21wdXRlZE9mZnNldCA/IHsgY29tcHV0ZWRPZmZzZXQgfSA6IHt9KVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC4uLihzdGlja1RvID8geyBzdGlja1RvIH0gOiB7fSlcbiAgICAgICAgICB9O1xuICAgICAgICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICAvKiBNZWFzdXJlIG5ldyBtZW51IHdpZHRoIGFuZCBoZWlnaHQgKi9cbiAgX29uTWVudUxheW91dCA9IChldmVudDogTGF5b3V0Q2hhbmdlRXZlbnQpOiB2b2lkID0+IHtcbiAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGV2ZW50Lm5hdGl2ZUV2ZW50LmxheW91dDtcbiAgICBjb25zdCB7IG1lbnVTdGF0ZSwgbWVudSB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGlmIChtZW51U3RhdGUgPT09IFNUQVRFUy5NRUFTVVJJTkcpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBtZW51U3RhdGU6IFNUQVRFUy5DQUxDVUxBVElORyxcbiAgICAgICAgbWVudToge1xuICAgICAgICAgIC4uLm1lbnUsXG4gICAgICAgICAgd2lkdGgsXG4gICAgICAgICAgaGVpZ2h0XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBfb25EaXNtaXNzID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLm9uSGlkZGVuKSB7XG4gICAgICB0aGlzLnByb3BzLm9uSGlkZGVuKCk7XG4gICAgfVxuICB9O1xuXG4gIGhpZGUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBhbmltYXRpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgQW5pbWF0ZWQudGltaW5nKHRoaXMuc3RhdGUuYW5pbWF0aW9uLm9wYWNpdHksIHtcbiAgICAgIHRvVmFsdWU6IDAsXG4gICAgICBkdXJhdGlvbjogQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgICAgZWFzaW5nOiBFQVNJTkcsXG4gICAgICB1c2VOYXRpdmVEcml2ZXI6IGZhbHNlXG4gICAgfSkuc3RhcnQoKCkgPT4ge1xuICAgICAgLyogUmVzZXQgc3RhdGUgKi9cbiAgICAgIHRoaXMuc2V0U3RhdGUoXG4gICAgICAgIHtcbiAgICAgICAgICBtZW51U3RhdGU6IFNUQVRFUy5ISURERU4sXG4gICAgICAgICAgYW5pbWF0aW9uOiB7XG4gICAgICAgICAgICAuLi5hbmltYXRpb24sXG4gICAgICAgICAgICBtZW51U2l6ZTogbmV3IEFuaW1hdGVkLlZhbHVlWFkoeyB4OiAwLCB5OiAwIH0pLFxuICAgICAgICAgICAgb3BhY2l0eTogbmV3IEFuaW1hdGVkLlZhbHVlKDApXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgLyogSW52b2tlIG9uSGlkZGVuIGNhbGxiYWNrIGlmIGRlZmluZWQgKi9cbiAgICAgICAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdpb3MnICYmIHRoaXMucHJvcHMub25IaWRkZW4pIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25IaWRkZW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IGRpbWVuc2lvbnMgPSBEaW1lbnNpb25zLmdldCgnc2NyZWVuJyk7XG4gICAgY29uc3QgeyBtZW51LCBjb21wb25lbnQsIGFuaW1hdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBtZW51U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBhbmltYXRpb24ubWVudVNpemUueCxcbiAgICAgIGhlaWdodDogYW5pbWF0aW9uLm1lbnVTaXplLnlcbiAgICB9O1xuXG4gICAgLyogQWRqdXN0IHBvc2l0aW9uIG9mIG1lbnUgKi9cbiAgICBjb25zdCB0cmFuc2Zvcm1zID0gW107XG5cbiAgICAvKiBGbGlwIGJ5IFggYXhpcyBpZiBtZW51IGhpdHMgcmlnaHQgc2NyZWVuIGJvcmRlciAqL1xuICAgIGlmIChtZW51LmxlZnQgPiBkaW1lbnNpb25zLndpZHRoIC0gbWVudS53aWR0aCAtIFNDUkVFTl9JTkRFTlQpIHtcbiAgICAgIHRyYW5zZm9ybXMucHVzaCh7XG4gICAgICAgIHRyYW5zbGF0ZVg6IEFuaW1hdGVkLm11bHRpcGx5KGFuaW1hdGlvbi5tZW51U2l6ZS54LCAtMSlcbiAgICAgIH0pO1xuXG4gICAgICBtZW51LmxlZnQgPSBNYXRoLm1pbihcbiAgICAgICAgZGltZW5zaW9ucy53aWR0aCAtIFNDUkVFTl9JTkRFTlQsXG4gICAgICAgIG1lbnUubGVmdCArIGNvbXBvbmVudC53aWR0aFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvKiBGbGlwIGJ5IFkgYXhpcyBpZiBtZW51IGhpdHMgYm90dG9tIHNjcmVlbiBib3JkZXIgKi9cbiAgICBpZiAobWVudS50b3AgPiBkaW1lbnNpb25zLmhlaWdodCAtIG1lbnUuaGVpZ2h0IC0gU0NSRUVOX0lOREVOVCkge1xuICAgICAgdHJhbnNmb3Jtcy5wdXNoKHtcbiAgICAgICAgdHJhbnNsYXRlWTogQW5pbWF0ZWQubXVsdGlwbHkoYW5pbWF0aW9uLm1lbnVTaXplLnksIC0xKVxuICAgICAgfSk7XG5cbiAgICAgIG1lbnUudG9wID0gTWF0aC5taW4oXG4gICAgICAgIGRpbWVuc2lvbnMuaGVpZ2h0IC0gU0NSRUVOX0lOREVOVCxcbiAgICAgICAgbWVudS50b3AgKyBjb21wb25lbnQuaGVpZ2h0XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHNoYWRvd01lbnVDb250YWluZXJTdHlsZSA9IHtcbiAgICAgIG9wYWNpdHk6IGFuaW1hdGlvbi5vcGFjaXR5LFxuICAgICAgdHJhbnNmb3JtOiB0cmFuc2Zvcm1zLFxuICAgICAgbGVmdDogbWVudS5sZWZ0LFxuICAgICAgdG9wOiBtZW51LnRvcFxuICAgIH07XG5cbiAgICBjb25zdCB7IG1lbnVTdGF0ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBhbmltYXRpb25TdGFydGVkID0gbWVudVN0YXRlID09PSBTVEFURVMuQU5JTUFUSU5HO1xuICAgIGNvbnN0IG1vZGFsVmlzaWJsZSA9XG4gICAgICBtZW51U3RhdGUgPT09IFNUQVRFUy5NRUFTVVJJTkcgfHxcbiAgICAgIG1lbnVTdGF0ZSA9PT0gU1RBVEVTLkNBTENVTEFUSU5HIHx8XG4gICAgICBtZW51U3RhdGUgPT09IFNUQVRFUy5TSE9XTiB8fFxuICAgICAgYW5pbWF0aW9uU3RhcnRlZDtcblxuICAgIGNvbnN0IHsgdGVzdElELCBzdHlsZSwgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHM7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgY29sbGFwc2FibGU9e2ZhbHNlfSB0ZXN0SUQ9e3Rlc3RJRH0+XG4gICAgICAgIDxNb2RhbFxuICAgICAgICAgIHZpc2libGU9e21vZGFsVmlzaWJsZX1cbiAgICAgICAgICBvblJlcXVlc3RDbG9zZT17dGhpcy5oaWRlfVxuICAgICAgICAgIHN1cHBvcnRlZE9yaWVudGF0aW9ucz17W1xuICAgICAgICAgICAgJ3BvcnRyYWl0JyxcbiAgICAgICAgICAgICdwb3J0cmFpdC11cHNpZGUtZG93bicsXG4gICAgICAgICAgICAnbGFuZHNjYXBlJyxcbiAgICAgICAgICAgICdsYW5kc2NhcGUtbGVmdCcsXG4gICAgICAgICAgICAnbGFuZHNjYXBlLXJpZ2h0J1xuICAgICAgICAgIF19XG4gICAgICAgICAgdHJhbnNwYXJlbnRcbiAgICAgICAgICBvbkRpc21pc3M9e3RoaXMuX29uRGlzbWlzc31cbiAgICAgICAgPlxuICAgICAgICAgIDxUb3VjaGFibGVXaXRob3V0RmVlZGJhY2sgb25QcmVzcz17dGhpcy5oaWRlfT5cbiAgICAgICAgICAgIDxWaWV3IHN0eWxlPXtTdHlsZVNoZWV0LmFic29sdXRlRmlsbH0+XG4gICAgICAgICAgICAgIDxBbmltYXRlZC5WaWV3XG4gICAgICAgICAgICAgICAgey4uLighYW5pbWF0aW9uU3RhcnRlZCA/IHsgb25MYXlvdXQ6IHRoaXMuX29uTWVudUxheW91dCB9IDoge30pfVxuICAgICAgICAgICAgICAgIHN0eWxlPXtbXG4gICAgICAgICAgICAgICAgICBzdHlsZXMuc2hhZG93TWVudUNvbnRhaW5lcixcbiAgICAgICAgICAgICAgICAgIHNoYWRvd01lbnVDb250YWluZXJTdHlsZSxcbiAgICAgICAgICAgICAgICAgIHN0eWxlXG4gICAgICAgICAgICAgICAgXX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxBbmltYXRlZC5WaWV3XG4gICAgICAgICAgICAgICAgICBzdHlsZT17W3N0eWxlcy5tZW51Q29udGFpbmVyLCBhbmltYXRpb25TdGFydGVkICYmIG1lbnVTaXplXX1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgICAgICAgPC9BbmltYXRlZC5WaWV3PlxuICAgICAgICAgICAgICA8L0FuaW1hdGVkLlZpZXc+XG4gICAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgICAgPC9Ub3VjaGFibGVXaXRob3V0RmVlZGJhY2s+XG4gICAgICAgIDwvTW9kYWw+XG4gICAgICA8L1ZpZXc+XG4gICAgKTtcbiAgfVxufVxuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIHNoYWRvd01lbnVDb250YWluZXI6IHtcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6ICd3aGl0ZScsXG4gICAgYm9yZGVyUmFkaXVzOiA0LFxuICAgIG9wYWNpdHk6IDAsXG5cbiAgICAvKiBTaGFkb3cgKi9cbiAgICAuLi5QbGF0Zm9ybS5zZWxlY3Qoe1xuICAgICAgaW9zOiB7XG4gICAgICAgIHNoYWRvd0NvbG9yOiAnYmxhY2snLFxuICAgICAgICBzaGFkb3dPZmZzZXQ6IHsgd2lkdGg6IDAsIGhlaWdodDogMiB9LFxuICAgICAgICBzaGFkb3dPcGFjaXR5OiAwLjE0LFxuICAgICAgICBzaGFkb3dSYWRpdXM6IDJcbiAgICAgIH0sXG4gICAgICBhbmRyb2lkOiB7XG4gICAgICAgIGVsZXZhdGlvbjogOFxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIG1lbnVDb250YWluZXI6IHtcbiAgICBvdmVyZmxvdzogJ2hpZGRlbidcbiAgfVxufSk7XG4iXX0=